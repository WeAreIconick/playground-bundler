(()=>{"use strict";var e={n:n=>{var l=n&&n.__esModule?()=>n.default:()=>n;return e.d(l,{a:l}),l},d:(n,l)=>{for(var r in l)e.o(l,r)&&!e.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:l[r]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=window.React,l=window.wp.plugins,r=window.wp.editor,o=window.wp.components,t=window.wp.element,a=window.wp.data,d=window.wp.blockEditor,s=window.wp.i18n,u=window.wp.apiFetch;var i=e.n(u);console.log("Playground Bundler: JavaScript loaded successfully"),console.log("Playground Bundler: playgroundBundler object:",window.playgroundBundler),console.log("Playground Bundler: wp.plugins available:",!!window.wp?.plugins),console.log("Playground Bundler: wp.editor available:",!!window.wp?.editor),console.log("Playground Bundler: wp.components available:",!!window.wp?.components),console.log("Playground Bundler: wp.element available:",!!window.wp?.element),console.log("Playground Bundler: wp.data available:",!!window.wp?.data),console.log("Playground Bundler: wp.blockEditor available:",!!window.wp?.blockEditor),console.log("Playground Bundler: wp.i18n available:",!!window.wp?.i18n),console.log("Playground Bundler: wp.apiFetch available:",!!window.wp?.apiFetch),console.log("Playground Bundler: Attempting to register plugin..."),console.log("Playground Bundler: About to register plugin..."),(0,l.registerPlugin)("playground-bundler",{render:()=>{const[e,l]=(0,t.useState)(!1),[u,g]=(0,t.useState)(!1),[c,p]=(0,t.useState)([]),[y,w]=(0,t.useState)([]),[m,b]=(0,t.useState)(null),[_,B]=(0,t.useState)(null),[P,f]=(0,t.useState)(!1),[h,E]=(0,t.useState)(null),{postId:v,blocks:k}=(0,a.useSelect)(e=>({postId:e("core/editor").getCurrentPostId(),blocks:e(d.store).getBlocks()}),[]),S=(0,t.useCallback)(async()=>{if(v){g(!0),B(null);try{console.log("Playground Bundler: Making analyze request..."),console.log("Playground Bundler: REST URL:",playgroundBundler.restUrl+"analyze/"+v),console.log("Playground Bundler: Using nonce:",playgroundBundler.nonce);const e=await i()({url:playgroundBundler.restUrl+"analyze/"+v,method:"GET",headers:{"X-WP-Nonce":playgroundBundler.nonce}});e.success&&(b(e.data),p(e.data.blocks||[]),w(e.data.media_types||[]))}catch(e){B(e.message||(0,s.__)("Failed to analyze content.","playground-bundler"))}finally{g(!1)}}},[v]);(0,t.useEffect)(()=>{k&&k.length>0&&v&&S()},[k,v,S]);const x=Array.isArray(c)?c.filter(e=>!e.startsWith("core/")):[],R=x.length>0,U=!!Array.isArray(y)&&y.length>0;return(0,n.createElement)(n.Fragment,null,(0,n.createElement)(r.PluginSidebarMoreMenuItem,{target:"playground-bundler-sidebar"},(0,s.__)("Playground Bundler","playground-bundler")),(0,n.createElement)(r.PluginSidebar,{name:"playground-bundler-sidebar",title:(0,s.__)("WordPress Playground Bundler","playground-bundler"),icon:"download"},(0,n.createElement)(o.PanelBody,{title:(0,s.__)("Detected Content","playground-bundler"),initialOpen:!0},u&&(0,n.createElement)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px"}},(0,n.createElement)(o.Spinner,null),(0,n.createElement)("span",{style:{marginLeft:"8px"}},(0,s.__)("Analyzing content…","playground-bundler"))),_&&(0,n.createElement)(o.Notice,{status:"error",isDismissible:!1},_),(0,n.createElement)("div",{style:{marginBottom:"16px"}},(0,n.createElement)("strong",null,(0,s.__)("Blocks:","playground-bundler")),(0,n.createElement)("p",{style:{fontSize:"13px",color:"#757575"}},c.length>0?`${c.length} block type(s) detected`:(0,s.__)("No blocks detected","playground-bundler")),R&&(0,n.createElement)(o.Notice,{status:"info",isDismissible:!1},(0,n.createElement)("strong",null,(0,s.__)("Custom blocks found:","playground-bundler")),(0,n.createElement)("ul",{style:{marginTop:"8px",paddingLeft:"20px"}},x.map(e=>(0,n.createElement)("li",{key:e,style:{fontSize:"12px"}},e))))),(0,n.createElement)("div",{style:{marginBottom:"16px"}},(0,n.createElement)("strong",null,(0,s.__)("Media Assets:","playground-bundler")),(0,n.createElement)("p",{style:{fontSize:"13px",color:"#757575"}},m?.media_count>0?`${m.media_count} asset(s) detected`:(0,s.__)("No media assets detected","playground-bundler")),U&&Array.isArray(y)&&(0,n.createElement)("ul",{style:{paddingLeft:"20px",fontSize:"12px"}},y.map((e,l)=>(0,n.createElement)("li",{key:l},e&&"string"==typeof e?e.charAt(0).toUpperCase()+e.slice(1):e," ","files"))))),(0,n.createElement)(o.PanelBody,{title:(0,s.__)("Generate Blueprint","playground-bundler"),initialOpen:!0},(0,n.createElement)("p",{style:{fontSize:"13px",marginBottom:"16px"}},(0,s.__)("Create a WordPress Playground blueprint bundle containing all blocks, plugins, and media assets from this page.","playground-bundler")),P?(0,n.createElement)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},(0,n.createElement)(o.Notice,{status:"success",isDismissible:!1},(0,s.__)("Bundle generated successfully!","playground-bundler")),(0,n.createElement)(o.Button,{variant:"primary",onClick:async()=>{if(h)try{console.log("Playground Bundler: Starting download..."),console.log("Playground Bundler: Download URL:",h.blueprint_url),console.log("Playground Bundler: Nonce:",playgroundBundler.nonce);const e=await fetch(h.blueprint_url,{method:"GET",headers:{"X-WP-Nonce":playgroundBundler.nonce}});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);console.log("Playground Bundler: Download response received");const n=await e.text();if(console.log("Playground Bundler: Raw response length:",n.length),console.log("Playground Bundler: Raw response preview:",n.substring(0,200)+"..."),console.log("Playground Bundler: Raw response end:","..."+n.substring(n.length-200)),!n.trim().endsWith("}"))throw console.error("Playground Bundler: Response appears truncated - does not end with }"),new Error("Response appears to be truncated or corrupted");const l=JSON.parse(n),r=JSON.stringify(l,null,2),o=new Blob([r],{type:"application/json"}),t=window.URL.createObjectURL(o),a=document.createElement("a");a.href=t,a.download=h.bundle_name+"-blueprint.json",a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t)}catch(e){console.error("Playground Bundler: Download error:",e),console.error("Playground Bundler: Error details:",{message:e.message,status:e.status,code:e.code,data:e.data}),B((0,s.__)("Download failed: "+(e.message||"Unknown error"),"playground-bundler"))}},style:{width:"100%"}},(0,s.__)("Download Bundle","playground-bundler")),(0,n.createElement)(o.Button,{variant:"secondary",onClick:()=>{if(h)try{console.log("Playground Bundler: Opening in WordPress Playground...");const e="https://playground.wordpress.net/?blueprint-url="+encodeURIComponent(h.blueprint_url);console.log("Playground Bundler: Opening URL:",e),window.open(e,"_blank","noopener,noreferrer")}catch(e){console.error("Playground Bundler: Error opening in playground:",e),B("Failed to open in WordPress Playground. Please try downloading the file instead.")}},style:{width:"100%"}},(0,s.__)("Open in Playground","playground-bundler")),(0,n.createElement)(o.Button,{variant:"tertiary",onClick:()=>{f(!1),E(null),B(null)},style:{width:"100%",fontSize:"12px"}},(0,s.__)("Generate New Bundle","playground-bundler"))):(0,n.createElement)(o.Button,{variant:"primary",onClick:async()=>{if(v){l(!0),B(null),f(!1),E(null);try{console.log("Playground Bundler: Making bundle request..."),console.log("Playground Bundler: REST URL:",playgroundBundler.restUrl+"bundle/"+v);const e=await i()({url:playgroundBundler.restUrl+"bundle/"+v,method:"POST",headers:{"X-WP-Nonce":playgroundBundler.nonce}});if(!e.success)throw new Error(e.message||(0,s.__)("Failed to generate bundle.","playground-bundler"));E(e.data),f(!0),B(null)}catch(e){let n=(0,s.__)("Failed to generate bundle.","playground-bundler");console.error("Playground Bundler: Bundle generation error:",e),429===e.status?n=(0,s.__)("Too many requests. Please wait 30 seconds before trying again.","playground-bundler"):403===e.status?n=(0,s.__)("Permission denied. Please refresh the page and try again.","playground-bundler"):500===e.status?n=(0,s.__)("Server error. Please try again in a moment.","playground-bundler"):e.message&&(n=e.message.includes("rate_limit")?(0,s.__)("Too many requests. Please wait before trying again.","playground-bundler"):e.message.includes("file_too_large")?(0,s.__)("Bundle too large. Please reduce content or media files.","playground-bundler"):e.message.includes("permission")?(0,s.__)("You do not have permission to generate bundles.","playground-bundler"):e.message),B(n),f(!1)}finally{l(!1)}}},isBusy:e,disabled:e||!v,style:{width:"100%",marginBottom:"12px"}},e?(0,s.__)("Generating Bundle…","playground-bundler"):(0,s.__)("Generate Bundle","playground-bundler")),!v&&(0,n.createElement)(o.Notice,{status:"warning",isDismissible:!1},(0,s.__)("Please save the post before generating a bundle.","playground-bundler")))))},icon:"download"}),console.log("Playground Bundler: Plugin registered successfully!")})();