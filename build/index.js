(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var l in n)e.o(n,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:n[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.plugins,l=window.wp.editor,r=window.wp.components,a=window.wp.element,o=window.wp.data,d=window.wp.blockEditor,s=(window.wp.coreData,window.wp.i18n),i=window.wp.apiFetch;var u=e.n(i);(0,n.registerPlugin)("playground-bundler",{render:()=>{const[e,n]=(0,a.useState)(!1),[i,c]=(0,a.useState)(!1),[p,g]=(0,a.useState)([]),[y,m]=(0,a.useState)([]),[b,w]=(0,a.useState)(null),[_,E]=(0,a.useState)(null),{postId:f,blocks:h,postType:B}=(0,o.useSelect)(e=>{const t=e("core/editor");return{postId:t.getCurrentPostId(),blocks:e(d.store).getBlocks(),postType:t.getCurrentPostType()}},[]);(0,a.useEffect)(()=>{h&&h.length>0&&f&&P(h)},[h,f]);const P=async e=>{if(f){c(!0),E(null);try{const e=await u()({path:`/playground-bundler/v1/analyze/${f}`,method:"GET"});e.success&&(w(e.data),g(e.data.blocks||[]),m(e.data.media_types||[]))}catch(e){console.error("Analysis error:",e),E(e.message||(0,s.__)("Failed to analyze content.","playground-bundler"))}finally{c(!1)}}},k=p.filter(e=>!e.startsWith("core/")),S=k.length>0,x=y.length>0;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.PluginSidebarMoreMenuItem,{target:"playground-bundler-sidebar"},(0,s.__)("Playground Bundler","playground-bundler")),(0,t.createElement)(l.PluginSidebar,{name:"playground-bundler-sidebar",title:(0,s.__)("WordPress Playground Bundler","playground-bundler"),icon:"download"},(0,t.createElement)(r.PanelBody,{title:(0,s.__)("Detected Content","playground-bundler"),initialOpen:!0},i&&(0,t.createElement)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px"}},(0,t.createElement)(r.Spinner,null),(0,t.createElement)("span",{style:{marginLeft:"8px"}},(0,s.__)("Analyzing content...","playground-bundler"))),_&&(0,t.createElement)(r.Notice,{status:"error",isDismissible:!1},_),(0,t.createElement)("div",{style:{marginBottom:"16px"}},(0,t.createElement)("strong",null,(0,s.__)("Blocks:","playground-bundler")),(0,t.createElement)("p",{style:{fontSize:"13px",color:"#757575"}},p.length>0?`${p.length} block type(s) detected`:(0,s.__)("No blocks detected","playground-bundler")),S&&(0,t.createElement)(r.Notice,{status:"info",isDismissible:!1},(0,t.createElement)("strong",null,(0,s.__)("Custom blocks found:","playground-bundler")),(0,t.createElement)("ul",{style:{marginTop:"8px",paddingLeft:"20px"}},k.map(e=>(0,t.createElement)("li",{key:e,style:{fontSize:"12px"}},e))))),(0,t.createElement)("div",{style:{marginBottom:"16px"}},(0,t.createElement)("strong",null,(0,s.__)("Media Assets:","playground-bundler")),(0,t.createElement)("p",{style:{fontSize:"13px",color:"#757575"}},b?.media_count>0?`${b.media_count} asset(s) detected`:(0,s.__)("No media assets detected","playground-bundler")),x&&(0,t.createElement)("ul",{style:{paddingLeft:"20px",fontSize:"12px"}},y.map((e,n)=>(0,t.createElement)("li",{key:n},e.charAt(0).toUpperCase()+e.slice(1)," files"))))),(0,t.createElement)(r.PanelBody,{title:(0,s.__)("Generate Blueprint","playground-bundler"),initialOpen:!0},(0,t.createElement)("p",{style:{fontSize:"13px",marginBottom:"16px"}},(0,s.__)("Create a WordPress Playground blueprint bundle containing all blocks, plugins, and media assets from this page.","playground-bundler")),(0,t.createElement)(r.Button,{variant:"primary",onClick:async()=>{if(f){n(!0),E(null);try{const e=await fetch(playgroundBundler.restUrl+`bundle/${f}`,{method:"POST",headers:{"X-WP-Nonce":playgroundBundler.nonce,"Content-Type":"application/json"}});if(!e.ok){const t=await e.json();throw new Error(t.message||(0,s.__)("Failed to generate bundle.","playground-bundler"))}const t=await e.blob(),n=document.createElement("a");n.href=window.URL.createObjectURL(t),n.download=`playground-bundle-${f}-${Date.now()}.zip`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(n.href)}catch(e){console.error("Bundle generation error:",e),E(e.message||(0,s.__)("Failed to generate bundle.","playground-bundler"))}finally{n(!1)}}},isBusy:e,disabled:e||!f,style:{width:"100%"}},e?(0,s.__)("Generating Bundle...","playground-bundler"):(0,s.__)("Download Blueprint Bundle","playground-bundler")),!f&&(0,t.createElement)(r.Notice,{status:"warning",isDismissible:!1},(0,s.__)("Please save the post before generating a bundle.","playground-bundler")))))},icon:"download"})})();