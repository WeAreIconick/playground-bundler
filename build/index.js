(()=>{"use strict";var e={n:n=>{var l=n&&n.__esModule?()=>n.default:()=>n;return e.d(l,{a:l}),l},d:(n,l)=>{for(var o in l)e.o(l,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:l[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=window.React,l=window.wp.plugins,o=window.wp.editor,r=window.wp.components,t=window.wp.element,a=window.wp.data,d=window.wp.blockEditor,u=window.wp.i18n,s=window.wp.apiFetch;var i=e.n(s);console.log("Playground Bundler: JavaScript loaded successfully"),console.log("Playground Bundler: playgroundBundler object:",window.playgroundBundler),console.log("Playground Bundler: wp.plugins available:",!!window.wp?.plugins),console.log("Playground Bundler: wp.editor available:",!!window.wp?.editor),console.log("Playground Bundler: wp.components available:",!!window.wp?.components),console.log("Playground Bundler: wp.element available:",!!window.wp?.element),console.log("Playground Bundler: wp.data available:",!!window.wp?.data),console.log("Playground Bundler: wp.blockEditor available:",!!window.wp?.blockEditor),console.log("Playground Bundler: wp.i18n available:",!!window.wp?.i18n),console.log("Playground Bundler: wp.apiFetch available:",!!window.wp?.apiFetch),console.log("Playground Bundler: Attempting to register plugin..."),console.log("Playground Bundler: About to register plugin..."),(0,l.registerPlugin)("playground-bundler",{render:()=>{const[e,l]=(0,t.useState)(!1),[s,c]=(0,t.useState)(!1),[g,p]=(0,t.useState)([]),[y,m]=(0,t.useState)([]),[w,b]=(0,t.useState)(null),[_,B]=(0,t.useState)(null),[P,f]=(0,t.useState)(!1),[E,h]=(0,t.useState)(null),{postId:k,blocks:v}=(0,a.useSelect)(e=>({postId:e("core/editor").getCurrentPostId(),blocks:e(d.store).getBlocks()}),[]),S=(0,t.useCallback)(async()=>{if(k){c(!0),B(null);try{console.log("Playground Bundler: Making analyze request..."),console.log("Playground Bundler: REST URL:",playgroundBundler.restUrl+"analyze/"+k),console.log("Playground Bundler: Using nonce:",playgroundBundler.nonce);const e=await i()({url:playgroundBundler.restUrl+"analyze/"+k,method:"GET",headers:{"X-WP-Nonce":playgroundBundler.nonce}});e.success&&(b(e.data),p(e.data.blocks||[]),m(e.data.media_types||[]))}catch(e){B(e.message||(0,u.__)("Failed to analyze content.","playground-bundler"))}finally{c(!1)}}},[k]);(0,t.useEffect)(()=>{v&&v.length>0&&k&&S()},[v,k,S]);const x=Array.isArray(g)?g.filter(e=>!e.startsWith("core/")):[],U=x.length>0,C=!!Array.isArray(y)&&y.length>0;return(0,n.createElement)(n.Fragment,null,(0,n.createElement)(o.PluginSidebarMoreMenuItem,{target:"playground-bundler-sidebar"},(0,u.__)("Playground Bundler","playground-bundler")),(0,n.createElement)(o.PluginSidebar,{name:"playground-bundler-sidebar",title:(0,u.__)("WordPress Playground Bundler","playground-bundler"),icon:"download"},(0,n.createElement)(r.PanelBody,{title:(0,u.__)("Detected Content","playground-bundler"),initialOpen:!0},s&&(0,n.createElement)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px"}},(0,n.createElement)(r.Spinner,null),(0,n.createElement)("span",{style:{marginLeft:"8px"}},(0,u.__)("Analyzing content…","playground-bundler"))),_&&(0,n.createElement)(r.Notice,{status:"error",isDismissible:!1},_),(0,n.createElement)("div",{style:{marginBottom:"16px"}},(0,n.createElement)("strong",null,(0,u.__)("Blocks:","playground-bundler")),(0,n.createElement)("p",{style:{fontSize:"13px",color:"#757575"}},g.length>0?`${g.length} block type(s) detected`:(0,u.__)("No blocks detected","playground-bundler")),U&&(0,n.createElement)(r.Notice,{status:"info",isDismissible:!1},(0,n.createElement)("strong",null,(0,u.__)("Custom blocks found:","playground-bundler")),(0,n.createElement)("ul",{style:{marginTop:"8px",paddingLeft:"20px"}},x.map(e=>(0,n.createElement)("li",{key:e,style:{fontSize:"12px"}},e))))),(0,n.createElement)("div",{style:{marginBottom:"16px"}},(0,n.createElement)("strong",null,(0,u.__)("Media Assets:","playground-bundler")),(0,n.createElement)("p",{style:{fontSize:"13px",color:"#757575"}},w?.media_count>0?`${w.media_count} asset(s) detected`:(0,u.__)("No media assets detected","playground-bundler")),C&&Array.isArray(y)&&(0,n.createElement)("ul",{style:{paddingLeft:"20px",fontSize:"12px"}},y.map((e,l)=>(0,n.createElement)("li",{key:l},e&&"string"==typeof e?e.charAt(0).toUpperCase()+e.slice(1):e," ","files"))))),(0,n.createElement)(r.PanelBody,{title:(0,u.__)("Generate Blueprint","playground-bundler"),initialOpen:!0},(0,n.createElement)("p",{style:{fontSize:"13px",marginBottom:"16px"}},(0,u.__)("Create a WordPress Playground blueprint bundle containing all blocks, plugins, and media assets from this page.","playground-bundler")),P?(0,n.createElement)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},(0,n.createElement)(r.Notice,{status:"success",isDismissible:!1},(0,u.__)("Bundle generated successfully!","playground-bundler")),(0,n.createElement)(r.Button,{variant:"primary",onClick:async()=>{if(E)try{console.log("Playground Bundler: Starting download..."),console.log("Playground Bundler: Download URL:",E.blueprint_url),console.log("Playground Bundler: Nonce:",playgroundBundler.nonce);const e=await fetch(E.blueprint_url,{method:"GET",headers:{"X-WP-Nonce":playgroundBundler.nonce}});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);console.log("Playground Bundler: Download response received");const n=await e.blob(),l=window.URL.createObjectURL(n),o=document.createElement("a");o.href=l,o.download=E.bundle_name+"-blueprint.json",o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(l)}catch(e){console.error("Playground Bundler: Download error:",e),console.error("Playground Bundler: Error details:",{message:e.message,status:e.status,code:e.code,data:e.data}),B((0,u.__)("Download failed: "+(e.message||"Unknown error"),"playground-bundler"))}},style:{width:"100%"}},(0,u.__)("Download Bundle","playground-bundler")),(0,n.createElement)(r.Button,{variant:"secondary",onClick:()=>{E&&window.open(E.playground_url,"_blank","noopener,noreferrer")},style:{width:"100%"}},(0,u.__)("Open in Playground","playground-bundler")),(0,n.createElement)(r.Button,{variant:"tertiary",onClick:()=>{f(!1),h(null),B(null)},style:{width:"100%",fontSize:"12px"}},(0,u.__)("Generate New Bundle","playground-bundler"))):(0,n.createElement)(r.Button,{variant:"primary",onClick:async()=>{if(k){l(!0),B(null),f(!1),h(null);try{console.log("Playground Bundler: Making bundle request..."),console.log("Playground Bundler: REST URL:",playgroundBundler.restUrl+"bundle/"+k);const e=await i()({url:playgroundBundler.restUrl+"bundle/"+k,method:"POST",headers:{"X-WP-Nonce":playgroundBundler.nonce}});if(!e.success)throw new Error(e.message||(0,u.__)("Failed to generate bundle.","playground-bundler"));h(e.data),f(!0),B(null)}catch(e){let n=(0,u.__)("Failed to generate bundle.","playground-bundler");e.message&&(n=e.message.includes("rate_limit")?(0,u.__)("Too many requests. Please wait before trying again.","playground-bundler"):e.message.includes("file_too_large")?(0,u.__)("Bundle too large. Please reduce content or media files.","playground-bundler"):e.message.includes("permission")?(0,u.__)("You do not have permission to generate bundles.","playground-bundler"):e.message),B(n),f(!1)}finally{l(!1)}}},isBusy:e,disabled:e||!k,style:{width:"100%",marginBottom:"12px"}},e?(0,u.__)("Generating Bundle…","playground-bundler"):(0,u.__)("Generate Bundle","playground-bundler")),!k&&(0,n.createElement)(r.Notice,{status:"warning",isDismissible:!1},(0,u.__)("Please save the post before generating a bundle.","playground-bundler")))))},icon:"download"}),console.log("Playground Bundler: Plugin registered successfully!")})();